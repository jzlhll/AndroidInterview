## 音视频开发教程

[音视频开发系列教程02-视频文件是什么？_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1kp4y187C7?vd_source=c2564a39cc59a81a52d9de6b7736dbfb&spm_id_from=333.788.videopod.episodes&p=2)

### 入门知识

ffplay播放起来会显示Stream。

```
ffplay -i xxx.mp4
ffplay -i xxx.mp4 -vst 1 //播放Stream1
```

 <img src=".\pictures\音视频001.png" alt="音视频001" style="zoom:48%;" />

* I, P, B帧

I帧: 帧内编码帧,关键帧,I帧可以看作一个图像经过压缩之后的产物,可以单独解码出一个完整的图像;
P帧: 前向预测编码帧,记录了本帧跟之前的一个关键帧(或P帧)的差别,解码时需要用之前缓存的画面叠
加上本帧定义的差别,生成最终画面。
B帧:双向预测编码帧,记录了本帧与前后帧的差别,解码需要参考前面一个l帧或者P帧,同时也需要后面的P
帧才能解码一张完整的图像。



<img src=".\pictures\IPBFrame.png" alt="screenshot-20250912-104816" style="zoom:57%;" />

* 如何编码

编码的目的,就是为了压缩。各种视频编码方式,都是为了让视频变得体积更小,有利于存储和传输。编码的核心思想就是**去除冗余信息**。
空间冗余:  图像内部相邻像素之间存在较强的相关性多造成的冗余。
时间冗余:  视频图像序列中的不同帧之间的相关性所造成的冗余。
视觉冗余:  是指人眼不能感知或不敏感的那部分图像信息。
信息熵冗余:  也称编码冗余,人们用于表达某一信息所需要的比特数总比理论上表示该信息所需要的最少比特数要大,它们之间的差距就是信息熵冗余,或称编码冗余。（哈夫曼算法）
知识冗余:  是指在有些图像中还包含与某些验证知识有关的信息。

* 编码规范

H.264（即MPEG-4 AVC）

H.265（高效率视频编码High Efficiency Video Coding, HEVC）



### 分析工具

[音视频码流工具汇总(建议收藏!)-腾讯云开发者社区-腾讯云](https://cloud.tencent.com/developer/article/2320126)

- **H264BSAnalyzer**

  由 CSDN 李迟大神开发，是一款专门针对 H.264/AVC 码流分析的工具。它具备不同版本，不仅能分析 H.264 码流，还能支持 H.265 码流分析。对于从事 H.264 和 H.265 相关音视频开发工作的人员来说，是非常实用的工具，其开源代码可在https://github.com/latelee/H264BSAnalyzer获取 。

- **VideoEye**

  这是一款开源的视频实时码流分析软件，支持 HTTP、RTMP、RTSP 以及文件等多种视频流输入方式。它能实时分析视频码流，并以图形化方式呈现结果，方便开发者直观了解码流情况。软件功能涵盖视频播放、压缩域码流分析（分析视频和音频压缩码流参数）以及非压缩域数据分析（分析视频解码后的像素数据）。下载地址为https://www.oschina.net/p/videoeye ，目前仍在完善中。

- **MediaInfo**

  可用于分析视频和音频文件的编码及内容信息。它不仅提供 DLL，还自带 GUI 工具用于查看音视频信息，不过不具备音视频播放功能。通过它能获取多媒体文件丰富的信息，如内容信息中的标题、作者等，视频方面的编码器、长宽比等，音频的编码器、采样率等，以及文本和段落相关信息。支持的文件格式众多，视频如 MKV、AVI 等，音频如 OGG、MP3 等，字幕如 SRT、SSA 等。下载地址是https://mediaarea.net/en/MediaInfo 。

- **播放器类工具**

  * YUV/RGB Player 

  雷霄骅大神修改后的一个 YUV/RGB 播放器，用来播放 YUV/RGB 文件的像素数据

  该播放器使用比较简单，可以通过菜单栏打开像素数据文件，也可以通过拖拽方式打开文件。如果文件名称中包含了 “{w}x{h}” 这样的字符串（例如 “test_320x420.yuv”），系统会自动解析为该像素数据的宽和高。

  注意：如果不能正常播放 YUV/RGB 文件，请检查分辨率和像素格式是否设置正确。https://github.com/leixiaohua1020/YUVplayer

  * MPV Player 

  mpv player 播放器是一款基于 MPlayer和mplayer2 的开源极简全能播放器，支持各类音视频格式，不只可以播放本地媒体，更可以播放网络媒体源，而且精简的界面没有任何广告，我们这里主要用来播放 H264 文件。https://sourceforge.net/projects/mpv-player-windows/files/

  * VLC Media Player

  自由开源跨平台多媒体播放器及框架，能播放多数多媒体文件及各类流媒体协议，主要用于 RTSP 拉流，下载地址为https://www.videolan.org/vlc/ 。

  * Potplayer

  高质量免费视频播放软件，支持变速播放等功能，能播放 RTSP\RTMP 网络视频流，解码强大，启动快、不占内存且无广告，下载地址为https://potplayer.en.softonic.com/?ex=DINS-635.2 。



### h.264码流分析



```
ffmpeg -i input.mp4 -an -vcodec copy output.h264 //提取h.264流
```

* 分层

H.264码流文件分为两层。

1. VCL(Video Coding Layer,视频编码层): 负责高效的视频内容表示,VCL数据即编码处理的输出,它表示被压
   缩编码后的视频数据序列。

2. NAL (Network Abstraction Layer,网络提取层):负责以网络所要求的恰当的方式对数据进行打包和传送,是传
   输层。不管在本地播放还是网络播放,都要通过这一层来传输。

> VCL就是被压缩编码后原始数据, 在VCL数据封装到NAL单元中之后,才可以用于传输或存储。

<img src=".\pictures\h264VCL_NAL.png" alt="h264VCL_NAL" style="zoom:50%;" />

* 片和宏块

一帧图片经过H.264编码器之后,就被编码为一个或多个**片**(slice)。

每片包含整数个**宏块**(Macroblock), 至少一个宏块, 最多包含整个图像宏块。

**NALU**就是装载着这些片(slice)的载体。

<img src=".\pictures\h264slices.png" alt="h264slices" style="zoom:43%;" />