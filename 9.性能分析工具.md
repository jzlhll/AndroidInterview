#### LeakCanary

**监控对象生命周期** → **触发GC并验证存活** → **分析引用链**。

基本流程：

通过一些手段监听viewModel，Service，Activity, Fragment的生命周期，在他们destroy的时候，通过**WeakReference**+**ReferenceQueue**来弱引用他们。然后过一会儿触发GC，看看是否存活。再通过heap dump下来，分析GC root。

概念和手段：

Activity监控：ActivityLifecycleCallbacks

Fragment监控：activity.supportFragmentManager.registerFragmentLifecycleCallbacks

Service、ViewModel有一些hook的办法来达到监听destroy的目的。

heap dump：堆抓取hprof文件



#### MAT

`adb shell am dumpheap <PID> /sdcard/heapdump.hprof`

就可以得到hprof文件。

拖入到MAT工具。有独立版本。

多关注Retained Heap，GC roots来看看哪些内存是无限多份的。

多关注Thread Overview，看看线程是否有跑过多，没有停下的。



#### Profiler

开发过程中使用，火焰图比较直观之类的。

日志也有skip xxx frames。可以看出打开界面这段时间是有掉帧的。



#### sysTrace和perfetto

adb shell perfetto -t 60s -o trace_file.perfetto-trace

然后导入到chrome://tracing里面去分析。